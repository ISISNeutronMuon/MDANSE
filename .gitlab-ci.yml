stages:
  - ci
  - deploy

# ubuntu pipeline
ci:ubuntu_xenial:
  stage: ci
  script:
    - docker build --force-rm --build-arg MDANSE_GIT_COMMIT=${CI_COMMIT_SHA} -t ci_mdanse_xenial -f ./BuildServer/Docker/Builder/Dockerfile_build .
  allow_failure: false
  only:
    - triggers
    - tags
    - release
    - hotfix
    - develop
    - /^feature-.*$/
    - /^bugfix-.*$/
  tags:
    - docker
    - sci
    - ubuntu

# ubuntu pipeline
deploy:ubuntu_xenial:
  stage: deploy
  script:
    - docker build --force-rm -t deploy_mdanse_xenial -f ./BuildServer/Docker/Builder/Dockerfile_deploy .
    - chmod 755 ./BuildServer/Docker/upload_artefacts.sh
    - echo `pwd`
    - ./BuildServer/Docker/upload_artefacts.sh
    - echo `ls`
    - echo `pwd`
    - echo ${CI_PROJECT_DIR}
  allow_failure: false
  only:
    - triggers
    - tags
    - release
    - hotfix
    - develop
    - /^feature-.*$/
    - /^bugfix-.*$/
  artifacts:
    paths:
    - ${CI_PROJECT_DIR}/*.deb
  tags:
    - docker
    - sci
    - ubuntu

