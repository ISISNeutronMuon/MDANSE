<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>5. Building MDANSE from source code &mdash; MDANSE 1.5.2 documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../_static/graphviz.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="6. Input and output files" href="files.html" />
    <link rel="prev" title="4. Installing MDANSE" href="installation.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> MDANSE
            <img src="../_static/mdanse_logo.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                1.5
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">MDANSE User Manual</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="opening.html">1. MDANSE User Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="authors.html">2. Acknowledgements</a></li>
<li class="toctree-l1"><a class="reference internal" href="introduction.html">3. Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">4. Installing MDANSE</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">5. Building MDANSE from source code</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#windows">5.1. Windows</a></li>
<li class="toctree-l2"><a class="reference internal" href="#macos">5.2. MacOS</a></li>
<li class="toctree-l2"><a class="reference internal" href="#linux">5.3. Linux</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="files.html">6. Input and output files</a></li>
<li class="toctree-l1"><a class="reference internal" href="gui.html">7. Using MDANSE Graphical User Interface</a></li>
<li class="toctree-l1"><a class="reference internal" href="cmd.html">8. Using MDANSE from command line</a></li>
<li class="toctree-l1"><a class="reference internal" href="trajectory.html">9. Trajectory Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="plotting.html">10. Plotting Options</a></li>
<li class="toctree-l1"><a class="reference internal" href="parameters.html">11. Glossary of Parameters</a></li>
<li class="toctree-l1"><a class="reference internal" href="references.html">12. References</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">MDANSE</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
      <li><span class="section-number">5. </span>Building MDANSE from source code</li>
      <li class="wy-breadcrumbs-aside">
            <a href="../_sources/pages/build.rst.txt" rel="nofollow"> View page source</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="building-mdanse-from-source-code">
<h1><span class="section-number">5. </span>Building MDANSE from source code<a class="headerlink" href="#building-mdanse-from-source-code" title="Permalink to this heading"></a></h1>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The MDANSE branch 1.5.x is still based on Python 2.
At the time this manual has been written, in 2022,
this makes it extremally difficult to find all the
necessary software dependencies.
It is strongly recommended to install a pre-built
package for your operating system instead of
building MDANSE from source yourself.
A new version of MDANSE, based on Python 3,
is currently under development.</p>
</div>
<p>MDANSE is an open-source software, and so the source code is widely
available. Currently, it is hosted by ISIS at GitHub
[<a class="reference external" href="#SignetBibliographie_038">38</a>]. The code can be freely altered and
distributed as per the GPL-3.0 license that it is licensed under. All
the necessary information is present in the repository. In any case
though, to access the very latest features that have not been released
via an executable, or to make custom alterations to the code, it is
necessary to build MDANSE from source code. Below are instructions on
how to do that on major platforms using Python 2. Please note that as of
writing this guide, MDANSE is compatible only with Python 2, but works
are under way to transfer MDANSE to Python 3, so in the future the code
in the repository may require different compilation instructions.</p>
<section id="windows">
<span id="windows-2"></span><h2><span class="section-number">5.1. </span>Windows<a class="headerlink" href="#windows" title="Permalink to this heading"></a></h2>
<p>To build MDANSE on Windows, the following software will have to be
downloaded and installed. All three programs have executables which can
be used in the typical windows fashion.</p>
<ul class="simple">
<li><p>Miniconda [<a class="reference external" href="#SignetBibliographie_039">39</a>] (or any other conda
installation)</p></li>
<li><p>Microsoft Visual Studio 2008 [<a class="reference external" href="#SignetBibliographie_040">40</a>]</p>
<ul>
<li><p>If MDANSE is to be built on an x64 system, during this
installation, the ‘x64 Compilers and Tools’ option has to be
selected. Alternatively, the complete installation can be
selected, which will install all parts including this one.</p></li>
</ul>
</li>
</ul>
<p>Then, download the following wheels from Ref
[<a class="reference external" href="#SignetBibliographie_041">41</a>], selecting the appropriate version
based on your architecture. The asterisks in the names stand for
architecture.</p>
<ul class="simple">
<li><p>wxPython_common‑3.0.2.0‑py2‑none‑any.whl</p></li>
<li><p>wxPython‑3.0.2.0‑cp27‑none‑win*.whl</p></li>
<li><p>PyQt4-4.11.4-cp27-cp27m-win*.whl</p></li>
<li><p>VTK-6.3.0-cp27-cp27m-win*.whl</p></li>
</ul>
<p>Afterwards, a virtual environment can be created and the wheels as well
as other dependencies can be installed into it.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda create --name envname python=2.7</span>
<span class="go">conda activate envname</span>
<span class="go">conda install h5py netCDF4</span>
<span class="go">pip install numpy==1.16.6 matplotlib==2.2.5 Cython==0.29.24 Pyro</span>
<span class="go">wxPython_common‑3.0.2.0‑py2‑none‑any.whl</span>
<span class="go">wxPython‑3.0.2.0‑cp27‑none‑win_amd64.whl</span>
<span class="go">VTK‑6.3.0‑cp27‑cp27m‑win_amd64.whl PyQt4‑4.11.4‑cp27‑cp27m‑win_amd64.whl</span>
</pre></div>
</div>
<p>Then, ScientificPython can be installed into the virtual environment.
This has to be done from source, using an ILL version of
ScientificPython.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone https://code.ill.fr/scientific-software/scientific-python.git</span>
<span class="go">cd scientific-python</span>
<span class="go">python setup.py --netcdf_prefix=dir_h --netcdf_dll=dir_dll build install</span>
</pre></div>
</div>
<p>In the second line, dir_h stands for the directory where the netcdf.h
file exists, and dir_dll for the location of netcdf.dll. The location of
both these files is inside the environment. If Miniconda was installed
into the default location, the .h file should be located in
C:\Users\username\Miniconda\envs\envname\Library\include\ and
.dll in C:\Users\username\Miniconda\envs\envname\Library\bin\
where username and envname are variable.</p>
<p>If an error is encountered pointing out that the location of netcdf.lib
file cannot be found, then the setup.py file has to be edited. Changing
the line 86, which should read netcdf_lib = netcdf_dll, to netcdf_lib =
r’path’, where path is the path to said file should fix the issue.
Alternatively, the line can be replaced with the following code:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">netcdf_dll</span><span class="p">,</span> <span class="s1">&#39;netcdf.lib&#39;</span><span class="p">)):</span>
    <span class="n">netcdf_lib</span> <span class="o">=</span> <span class="n">netcdf_dll</span>
<span class="k">elif</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">netcdf_dll</span><span class="p">),</span> <span class="s1">&#39;lib&#39;</span><span class="p">,</span>
<span class="s1">&#39;netcdf.lib&#39;</span><span class="p">)):</span>
    <span class="n">netcdf_lib</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">dirname</span><span class="p">(</span><span class="n">netcdf_dll</span><span class="p">),</span> <span class="s1">&#39;lib&#39;</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="nb">print</span> <span class="s2">&quot;netcdf.lib could not be found&quot;</span>
    <span class="k">raise</span> <span class="ne">SystemExit</span>
</pre></div>
</div>
<p>Any other errors can be attempted to be solved by running “C:\Program
Files (x86)\Microsoft Visual Studio 9.0\VC\bin\vcvars32.bat” on x32
systems and “C:\Program Files (x86)\Microsoft Visual Studio
9.0\VC\bin\amd64\vcvarsamd64.bat” on x64 systems. If a missing
vcvarsall.bat error is encountered after that, Visual Studio 2008 might
have to be reinstalled (not to forget to install the x64 Tools).</p>
<p>Once ScientificPython is installed successfully, MMTK and MDANSE can be
built and installed from source.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">git clone https://code.ill.fr/scientific-software/mmtk.git</span>
<span class="go">cd mmtk</span>
<span class="go">python setup.py install</span>
<span class="go">git clone https://github.com/ISISNeutronMuon/MDANSE.git</span>
<span class="go">cd MDANSE</span>
<span class="go">python setup.py build install</span>
</pre></div>
</div>
<p>After that, MDANSE can be used from command line as per usual, and the
GUI can be started by running</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">python path\\envname\\Scripts\\mdanse_gui</span>
</pre></div>
</div>
</section>
<section id="macos">
<span id="macos-2"></span><h2><span class="section-number">5.2. </span>MacOS<a class="headerlink" href="#macos" title="Permalink to this heading"></a></h2>
<p>Like on Windows, on MacOS the easiest way to build MDANSE is to use
conda all the way, which can be downloaded from Ref
[<a class="reference external" href="#SignetBibliographie_042">42</a>]. A virtualenv/venv environment can
be used but conda still has to be used to download multiple packages
unless they are built from source. This guide uses conda fully.</p>
<p>First, create a conda virtual environment and install dependencies
(envname can be whatever name desirable for the environment).</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda create --name envname python=2.7</span>
<span class="go">conda activate envname</span>
<span class="go">conda install h5py netCDF4</span>
<span class="go">pip install numpy==1.16.6 matplotlib==2.2.5 Cython==0.29.24 Pyro pyyaml</span>
<span class="go">sudo conda install -y -c daf wxpython</span>
<span class="go">sudo conda install -y -c ccordoba12 vtk</span>
</pre></div>
</div>
<p>Afterwards, ScientificPython, MMTK, and MDANSE can be built and
installed from source code. Please note that the NETCDF_HEADER_FILE_PATH
below has to be set to the location of the directory of netcdf.h.</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">export NETCDF_HEADER_FILE_PATH=/Users/username/Miniconda/envs/envname/include</span>
<span class="go">git clone https://code.ill.fr/scientific-software/scientific-python.git</span>
<span class="go">cd scientific-python/</span>
<span class="go">python setup.py install</span>
<span class="go">git clone https://code.ill.fr/scientific-software/mmtk.git</span>
<span class="go">cd mmtk</span>
<span class="go">spython setup.py install</span>
<span class="go">git clone https://github.com/ISISNeutronMuon/MDANSE.git</span>
<span class="go">cd MDANSE</span>
<span class="go">python setup.py install</span>
</pre></div>
</div>
<p>If there are any permission issues, the installation will have to be
performed with elevated privileges and full path to python, ie.
path/envname/bin/python. Afterwards, MDANSE can be used from command
line like normal, and the GUI can be started by running:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">path/envname/bin/mdanse_gui</span>
</pre></div>
</div>
</section>
<section id="linux">
<span id="linux-2"></span><h2><span class="section-number">5.3. </span>Linux<a class="headerlink" href="#linux" title="Permalink to this heading"></a></h2>
<p>The installation on various linux platforms is similar to that on MacOS,
with the main difference being what the required libraries are called.
This also differs a lot between various linux distributions, and many
may already be installed. Further, which libraries have to be installed
depends if you plan to build Python, wxpython, and VTK from source. In
any case, what is always required is a C compiler, preferably GTK2, and
netcdf. A development version of netcdf, something like netcdf-devel,
may also be necessary. An exact guide for when everything is built from
source on CentOS 7 is on MDANSE GitHub issue #8
[<a class="reference external" href="#SignetBibliographie_005">5</a>]. Other than that, we do not keep
instructions specific to any other distributions, though inspiration can
be taken from our continuous integration pipeline at
.github/workflows/CI.yml.</p>
<p>Given this complexity and other reasons, it is advisable that conda is
used for building MDANSE, which makes installing packages much simpler
and should reduce the dependence on distribution somewhat. The steps to
follow are such:</p>
<div class="highlight-console notranslate"><div class="highlight"><pre><span></span><span class="go">conda create --name envname python=2.7</span>
<span class="go">conda activate envname</span>
<span class="go">conda install h5py netCDF4</span>
<span class="go">pip install numpy==1.16.6 matplotlib==2.2.5 Cython==0.29.24 Pyro pyyaml</span>
<span class="go">sudo conda install -y -c daf wxpython</span>
<span class="go">sudo conda install -y -c ccordoba12 vtk</span>
<span class="go">export NETCDF_HEADER_FILE_PATH=/usr/include/</span>
<span class="go">git clone https://code.ill.fr/scientific-software/scientific-python.git</span>
<span class="go">cd scientific-python/</span>
<span class="go">python setup.py install</span>
<span class="go">git clone https://code.ill.fr/scientific-software/mmtk.git</span>
<span class="go">cd mmtk</span>
<span class="go">spython setup.py install</span>
<span class="go">git clone https://github.com/ISISNeutronMuon/MDANSE.git</span>
<span class="go">cd MDANSE</span>
<span class="go">python setup.py install</span>
</pre></div>
</div>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="installation.html" class="btn btn-neutral float-left" title="4. Installing MDANSE" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="files.html" class="btn btn-neutral float-right" title="6. Input and output files" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2015, Gael Goret, Bachir Aoun and Eric C. Pellegrini.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>